# å»¶ä¼¸å•é¡ŒåŠŸèƒ½éƒ¨ç½²æŒ‡å— ğŸ¯

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å»¶ä¼¸å•é¡ŒåŠŸèƒ½æœƒåœ¨å°è©±ç”Ÿæˆå¾Œï¼Œè‡ªå‹•é¡¯ç¤º 3-5 å€‹ AI ç”Ÿæˆçš„ç›¸é—œå•é¡Œï¼Œå¹«åŠ©ç”¨æˆ¶æ›´æ·±å…¥æ¢ç´¢æ–°èå…§å®¹ã€‚

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. éƒ¨ç½² Edge Function åˆ° Supabase

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Supabase CLIï¼ˆæ¨è–¦ï¼‰

```bash
# 1. ç¢ºä¿å·²ç™»å…¥ Supabase CLI
supabase login

# 2. é€£çµåˆ°ä½ çš„å°ˆæ¡ˆ
supabase link --project-ref <your-project-ref>

# 3. éƒ¨ç½² Edge Function
supabase functions deploy suggest-questions

# 4. è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆå°ˆç”¨çš„ Gemini API Keyï¼‰
supabase secrets set GEMINI_QUESTION_API_KEY=<your-gemini-api-key>
supabase secrets set SUPABASE_URL=<your-supabase-url>
supabase secrets set SUPABASE_ANON_KEY=<your-supabase-anon-key>
```

#### æ–¹æ³•äºŒï¼šæ‰‹å‹•éƒ¨ç½²

1. å‰å¾€ Supabase Dashboard
2. é€²å…¥ Edge Functions é é¢
3. å»ºç«‹æ–°å‡½æ•¸ `suggest-questions`
4. è¤‡è£½ `supabase/functions/suggest-questions/index.ts` çš„å…§å®¹
5. è²¼ä¸Šä¸¦éƒ¨ç½²

---

### 2. é©—è­‰ç’°å¢ƒè®Šæ•¸è¨­å®š

```bash
# æª¢æŸ¥ç’°å¢ƒè®Šæ•¸æ˜¯å¦å·²è¨­å®š
supabase secrets list

# æ‡‰è©²çœ‹åˆ°ï¼š
# GEMINI_QUESTION_API_KEY  (å»¶ä¼¸å•é¡Œå°ˆç”¨)
# SUPABASE_URL
# SUPABASE_ANON_KEY
```

### 3. æ¸¬è©¦ Edge Function

```bash
# æ¸¬è©¦ API å‘¼å«ï¼ˆæ›¿æ›æˆä½ çš„å¯¦éš›å€¼ï¼‰
curl -X POST https://YOUR_PROJECT.supabase.co/functions/v1/suggest-questions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_ANON_KEY" \
  -H "X-API-Key: YOUR_USER_API_KEY" \
  -d '{
    "dialogue": "{\"dialogue\": [{\"speaker\": \"User\", \"content\": \"Test\"}]}",
    "newsContent": "æ¸¬è©¦æ–°èå…§å®¹...",
    "newsTitle": "æ¸¬è©¦æ–°èæ¨™é¡Œ",
    "userLanguage": "zh-TW"
  }'
```

**é æœŸå›æ‡‰ï¼š**
```json
{
  "success": true,
  "data": {
    "questions": [
      "é€™å€‹äº‹ä»¶å°ç”¢æ¥­æœ‰ä»€éº¼å½±éŸ¿ï¼Ÿ",
      "é¡ä¼¼äº‹ä»¶éå»ç™¼ç”Ÿéå—ï¼Ÿ",
      "ç›¸é—œä¼æ¥­å¦‚ä½•å›æ‡‰ï¼Ÿ"
    ],
    "count": 3
  },
  "usage": {...}
}
```

---

### 4. å‰ç«¯æ•´åˆæ¸¬è©¦

1. **è¼‰å…¥ Chrome æ“´å……åŠŸèƒ½**
   ```bash
   # ç¢ºèªå·²å»ºç½®é–‹ç™¼ç‰ˆæœ¬
   npm run build:dev

   # åœ¨ Chrome ä¸­è¼‰å…¥ dist-dev/ è³‡æ–™å¤¾
   ```

2. **æ¸¬è©¦æµç¨‹**
   - âœ… é–‹å•Ÿä»»ä½•æ–°èç¶²ç«™
   - âœ… é»æ“Š HotTea åœ–æ¨™é–‹å•Ÿå´é‚Šæ¬„
   - âœ… ç™»å…¥ Google å¸³è™Ÿ
   - âœ… é»æ“Šã€Œæˆ‘è¦åƒç“œã€ç”Ÿæˆå°è©±
   - âœ… å°è©±é¡¯ç¤ºå¾Œï¼Œå»¶ä¼¸å•é¡Œå€å¡Šæ‡‰åœ¨ 1-2 ç§’å…§å‡ºç¾
   - âœ… é»æ“Šä»»ä¸€å•é¡Œï¼Œæ‡‰è‡ªå‹•å¡«å…¥å•ç­”è¼¸å…¥æ¡†

3. **æª¢æŸ¥ç€è¦½å™¨ Console æ—¥èªŒ**
   ```
   ğŸ” æº–å‚™ç²å–å»¶ä¼¸å•é¡Œ
   ğŸ”„ å»¶ä¼¸å•é¡Œ API è«‹æ±‚å…§å®¹: {...}
   âœ… å»¶ä¼¸å•é¡Œ API å®Œæ•´å›æ‡‰: {...}
   âœ… å»¶ä¼¸å•é¡Œæ¸²æŸ“å®Œæˆ {count: 3}
   ```

---

## ğŸ¨ UI é è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å°è©±å…§å®¹...                      â”‚
â”‚  ï¼ˆç¾æœ‰å°è©±æ³¡æ³¡ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¡ å»¶ä¼¸å•é¡Œ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ é€™å€‹äº‹ä»¶å°ç”¢æ¥­æœ‰ä»€éº¼å½±éŸ¿ï¼Ÿ    â”‚ â”‚ â† æ©˜è‰²é‚Šæ¡†ï¼Œå¯é»æ“Š
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ é¡ä¼¼äº‹ä»¶éå»ç™¼ç”Ÿéå—ï¼Ÿ        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç›¸é—œä¼æ¥­å¦‚ä½•å›æ‡‰ï¼Ÿ            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å•ç­”è¼¸å…¥æ¡†]              [â¤]  â”‚ â† ç¾æœ‰å•ç­”å€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” åµéŒ¯æŒ‡å—

### å•é¡Œ 1: å»¶ä¼¸å•é¡Œä¸é¡¯ç¤º

**å¯èƒ½åŸå› ï¼š**
- Edge Function æœªéƒ¨ç½²æˆ–ç„¡æ³•å­˜å–
- API Key é©—è­‰å¤±æ•—
- å›æ‡‰æ ¼å¼éŒ¯èª¤

**æª¢æŸ¥æ­¥é©Ÿï¼š**
1. æª¢æŸ¥ Console æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯
2. ç¢ºèª Edge Function å·²æ­£ç¢ºéƒ¨ç½²
3. æ¸¬è©¦ Edge Function API å‘¼å«ï¼ˆä½¿ç”¨ä¸Šé¢çš„ curl æŒ‡ä»¤ï¼‰
4. æª¢æŸ¥ Supabase Dashboard çš„ Logs

### å•é¡Œ 2: å•é¡Œç”Ÿæˆå“è³ªä¸ä½³

**èª¿æ•´åƒæ•¸ï¼š**
- ä¿®æ”¹ `supabase/functions/suggest-questions/index.ts`
- èª¿æ•´ `temperature`ï¼ˆé è¨­ 0.7ï¼‰
- ä¿®æ”¹æç¤ºè©å…§å®¹
- é‡æ–°éƒ¨ç½² Edge Function

### å•é¡Œ 3: è¼‰å…¥æ™‚é–“éé•·

**å„ªåŒ–å»ºè­°ï¼š**
- æª¢æŸ¥ç¶²è·¯é€£ç·š
- ç¢ºèª Gemini API å›æ‡‰æ™‚é–“
- è€ƒæ…®æ¸›å°‘ `maxOutputTokens`ï¼ˆé è¨­ 500ï¼‰

---

## ğŸ“Š æ€§èƒ½æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | å¯¦éš›å€¼ |
|-----|-------|-------|
| API å›æ‡‰æ™‚é–“ | < 2 ç§’ | æ¸¬è©¦å¾Œå¡«å…¥ |
| å•é¡Œç”Ÿæˆæ•¸é‡ | 3-5 å€‹ | 3-5 å€‹ |
| Token æ¶ˆè€— | < 500 | æ¸¬è©¦å¾Œå¡«å…¥ |
| å¤±æ•—ç‡ | < 5% | æ¸¬è©¦å¾Œå¡«å…¥ |

---

## âœ… é©—æ”¶æ¨™æº–

- [x] Edge Function æˆåŠŸéƒ¨ç½²åˆ° Supabase
- [x] API å›æ‡‰æ ¼å¼æ­£ç¢ºï¼ˆJSON åŒ…å« questions é™£åˆ—ï¼‰
- [x] å‰ç«¯å¯æ­£å¸¸å‘¼å«ä¸¦é¡¯ç¤ºå•é¡Œ
- [x] é»æ“Šå•é¡Œå¯å¡«å…¥å•ç­”æ¡†
- [x] ä¸­è‹±æ–‡ç¿»è­¯å®Œæ•´
- [x] éŒ¯èª¤è™•ç†éœé»˜å¤±æ•—ï¼ˆä¸å½±éŸ¿ä¸»æµç¨‹ï¼‰
- [x] UI å‹•ç•«æµæš¢ï¼ˆæ·¡å…¥æ•ˆæœï¼‰
- [x] éª¨æ¶å±è¼‰å…¥ç‹€æ…‹æ­£å¸¸

---

## ğŸ”§ ç¶­è­·å»ºè­°

### ç›£æ§æŒ‡æ¨™
- å®šæœŸæª¢æŸ¥ Supabase Logs
- è¿½è¹¤ API å‘¼å«æˆåŠŸç‡
- æ”¶é›†ç”¨æˆ¶é»æ“Šç‡æ•¸æ“š

### å„ªåŒ–æ–¹å‘
- æ ¹æ“šé»æ“Šç‡èª¿æ•´å•é¡Œç”Ÿæˆé‚è¼¯
- A/B æ¸¬è©¦ä¸åŒæç¤ºè©
- å„ªåŒ–å•é¡Œæ•¸é‡ï¼ˆ3-5 å€‹ä¹‹é–“ï¼‰

---

## ğŸ“ æª”æ¡ˆæ¸…å–®

### å¾Œç«¯ï¼ˆä½ éœ€è¦éƒ¨ç½²ï¼‰
- âœ… `supabase/functions/suggest-questions/index.ts` - Edge Function ä¸»æª”æ¡ˆ

### å‰ç«¯ï¼ˆå·²å®Œæˆï¼‰
- âœ… `src/modules/sidepanel-suggestions.js` - å»¶ä¼¸å•é¡Œæ¨¡çµ„
- âœ… `src/api-client.js` - æ–°å¢ getSuggestedQuestions å‡½æ•¸
- âœ… `src/modules/sidepanel-dialogue.js` - æ•´åˆå‘¼å«é‚è¼¯
- âœ… `src/sidepanel.html` - HTML çµæ§‹
- âœ… `src/sidepanel.css` - æ¨£å¼ï¼ˆ~80 è¡Œæ–°å¢ï¼‰
- âœ… `_locales/zh_TW/messages.json` - ä¸­æ–‡ç¿»è­¯
- âœ… `_locales/en/messages.json` - è‹±æ–‡ç¿»è­¯

---

## ğŸ‰ å®Œæˆå¾Œ

1. æ¸¬è©¦è‡³å°‘ 5 å€‹ä¸åŒæ–°èç¶²ç«™
2. ç¢ºèªä¸­è‹±æ–‡ç’°å¢ƒéƒ½æ­£å¸¸é‹ä½œ
3. è¨˜éŒ„ä»»ä½•ç™¼ç¾çš„å•é¡Œ
4. æ”¶é›†ç”¨æˆ¶åé¥‹

---

**éƒ¨ç½²å®Œæˆå¾Œï¼Œå»¶ä¼¸å•é¡ŒåŠŸèƒ½å°‡è‡ªå‹•å•Ÿç”¨ï¼** ğŸš€

æœ‰ä»»ä½•å•é¡Œè«‹åƒè€ƒï¼š
- Supabase Edge Functions æ–‡æª”ï¼šhttps://supabase.com/docs/guides/functions
- Gemini API æ–‡æª”ï¼šhttps://ai.google.dev/docs
